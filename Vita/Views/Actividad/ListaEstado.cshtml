@{
    ViewBag.Title = "ListaActividades";
    Layout = "~/Views/Shared/_LayoutPerfilEntidad.cshtml";
}
@model Usuario

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>

<section class="container-fluid">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Hay @ViewBag.ListaUsuario.Count usuarios en la actividad, con estado </h4><br />
            <h6 style="color:#76838f"> @ViewBag.Actividad.Titulo, @ViewBag.Actividad.Descripcion</h6>
            <form action="/Actividad/AprobarUsuario" method="post">
                <input type="number" value="@ViewBag.Actividad.Id" name="ActividadId" hidden />
                <div class="table-responsive">

                    <br /><br />

                    @if (ViewBag.Estado == "2" || ViewBag.Estado== "9") //Sólo en el estado PENDIENTE muestro los botones de aprobar y rechazar
                    {
                        <div class="header-left" style="margin-left:80%;">
                            <a href=#><button type="submit" class="btn mb-1 gradient-3" id="btnAprobar" name=Estado value=true>Aprobar</button> </a>
                            <a href=#><button type="submit" class="btn mb-1 gradient-1" id="btnRechazar" name=Estado value=false>Rechazar</button> </a>
                        </div>
                    }
                    @if (ViewBag.Estado == "1") //Sólo en el estado APROBADO puede rechazar
                    {
                        <div class="header-left" style="margin-left:80%;">
                            <a href=#><button type="submit" class="btn mb-1 gradient-1" id="btnRechazar" name=Estado value=false>Rechazar</button> </a>
                        </div>
                    }
                    <br><br><br><br><br>




                    <table class="table header-border table-hover verticle-middle">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectall" value="1" onchange='selectAll()' /></th>
                                <th scope="col"></th>
                                <th scope="col">Nombre y apellido</th>
                                <th scope="col">Zona</th>
                                <th scope="col">Edad</th>
                                <th scope="col">Sexo</th>
                                <th scope="col">Estado</th>
                                @if (ViewBag.Estado == "2") //Pendiente
                                {
                                    <th scope="colgroup">Formulario</th>
                                }
                            </tr>
                        </thead>
                        <tbody>

                            @*@foreach (Actividad i in Model)*@
                            @foreach (Usuario i in ViewBag.ListaUsuario)
                            {
                                var estado = i.UsuarioInscriptoActividad.Where(x => x.UsuarioId == i.Id).FirstOrDefault().Estado.Descripcion;

                                if (i.Foto != null && i.Foto.Length > 0)
                                {
                                    ViewBag.Url = i.Foto;
                                }
                                else
                                {
                                    ViewBag.Url = "/Content/images/sin_foto.png";
                                }
                                <input type="number" value=@i.Id
                                       name="UsuarioId" hidden />
                                <input type="number" value=@i.UsuarioInscriptoActividad.Where(x => x.UsuarioId == i.Id).FirstOrDefault().Estado.Id
                                       name="EstadoAnterior" hidden />
                                <tr>

                                    <td><input type="checkbox" class="case" name="case" /></td>
                                    <td><img src="@Url.Content(ViewBag.Url)" style="width: 190px; height: 120px;"></td>
                                    <td>@i.Nombre @i.Apellido</td>
                                    <td>@i.Localidad.Descripcion</td>
                                    <td>@Convert.ToInt32(@DateTime.Now.Year - @i.FechaNacimiento.Value.Year)</td>
                                    <td>@i.Sexo.Descripcion</td>
                                    <td>
                                        @estado
                                        @*@i.UsuarioInscriptoActividad.Where(x => x.UsuarioId == Model.Id && x.ActividadId == i.Id).FirstOrDefault().Estado.Descripcion*@
                                    </td>
                                    @if (ViewBag.Estado == "2") //Pendiente
                                    {
                                        <td>
                                            <div style="text-align:center"><a href="/Actividad/RespuestasFormularioDinamico?actividadId=@ViewBag.Actividad.Id&usuarioRespuestaId=@i.Id"><span data-toggle="tooltip" data-placement="top" title="Ver respuestas del formulario"><i class="fa fa-eye fa-2x" aria-hidden="true"></i></span></a></div>
                                        </td>
                                    }
                                    
                                </tr>
                            }


                        </tbody>
                    </table>

            </form>
        </div>
    </div>
    </div>
    <script type="text/javascript">
        function selectAll() {
            var items = document.getElementsByName('case');
            for (var i = 0; i < items.length; i++) {
                if (items[i].type == 'checkbox' && items[i].checked == true) {
                    items[i].checked = false;
                } else {
                    items[i].checked = true;
                }

            }

        }


    </script>

    <script type="text/javascript">
        $(function () {
            $('#btnAprobar').attr('disabled', 'disabled');
            $('#btnRechazar').attr('disabled', 'disabled');

            $('#selectall').click(function () {
                if ($(this).is(':checked')) {
                    $('#btnAprobar').removeAttr('disabled');
                    $('#btnRechazar').removeAttr('disabled');

                } else {
                    $('#btnAprobar').attr('disabled', 'disabled');
                    $('#btnRechazar').attr('disabled', 'disabled');
                }
            });

            $('.case').change(function () {
                if ($(this).is(':checked')) {
                    $('#btnAprobar').removeAttr('disabled');
                    $('#btnRechazar').removeAttr('disabled');

                } else {
                    $('#btnAprobar').attr('disabled', 'disabled');
                    $('#btnRechazar').attr('disabled', 'disabled');
                }
            });
        });
    </script>
</section>